{% extends "base.html" %}
{% if error %}
<div class="alert alert-warning">
  {{ error }}
</div>
{% endif %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-4">
  <h4 class="mb-0">Détails du host : {{ host.hostname }}</h4>
  <div>
    <a class="btn btn-outline-secondary me-2" href="{{ url_for('host_edit', host_id=host.id) }}">Modifier</a>
    <a class="btn btn-primary" href="{{ url_for('admin') }}">Retour</a>
  </div>
</div>

<!-- Infos principales -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <dl class="row mb-0">
      <dt class="col-sm-3">IP / Port</dt>
      <dd class="col-sm-9">{{ host.ip }}:{{ host.port }}</dd>

      <dt class="col-sm-3">Communauté SNMP</dt>
      <dd class="col-sm-9">{{ host.snmp_community }}</dd>

      <dt class="col-sm-3">Description</dt>
      <dd class="col-sm-9">{{ host.description or "—" }}</dd>

      <dt class="col-sm-3">Catégories</dt>
      <dd class="col-sm-9">
        {% if host.snmp_categories %}
          {% for c in host.snmp_categories %}
            <span class="badge bg-info text-dark me-1">{{ c }}</span>
          {% endfor %}
        {% else %}—{% endif %}
      </dd>
    </dl>
  </div>
</div>

<!-- Métriques SNMP -->
{% if metrics %}
  {% for category, values in metrics.items() %}
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h5 class="card-title text-capitalize">{{ category }}</h5>

        <!-- SYSTEM -->
        {% if category == "system" %}
          <table class="table table-sm">
            <thead>
              <tr><th>OID</th><th>Valeur</th></tr>
            </thead>
            <tbody>
              {% for oid, val in values.items() %}
                <tr>
                  <td class="text-monospace">{{ oid }}</td>
                  <td>{{ val }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}

        <!-- CPU -->
        {% if category == "cpu" %}
          <table class="table table-sm">
            <thead>
              <tr><th>CPU</th><th>Charge</th></tr>
            </thead>
            <tbody>
              {% for cpu, load in values.items() %}
                <tr>
                  <td>{{ cpu }}</td>
                  <td>{{ load }}%</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}

        <!-- STORAGE -->
        {% if category == "storage" %}
          <table class="table table-sm">
            <thead>
              <tr><th>Nom</th><th>Utilisé</th><th>Total</th><th>%</th></tr>
            </thead>
            <tbody>
              {% for name, info in values.items() %}
                <tr>
                  <td>{{ name }}</td>
                  <td>{{ info.used }}</td>
                  <td>{{ info.total }}</td>
                  <td>
                    {% if info.total and info.total > 0 %}
                      {{ "%.1f"|format((info.used / info.total) * 100) }}%
                    {% else %}
                      —
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}

        <!-- INTERFACES -->
        {% if category == "interfaces" %}
          <table class="table table-sm">
            <thead>
              <tr><th>Interface</th><th>État</th></tr>
            </thead>
            <tbody>
              {% for iface, state in values.items() %}
                <tr>
                  <td>{{ iface }}</td>
                  <td>
                    {% if state|string|lower in ["up", "1", "true"] %}
                      <span class="badge bg-success">Up</span>
                    {% else %}
                      <span class="badge bg-danger">Down</span>
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}
      </div>
    </div>
  {% endfor %}
{% else %}
  <div class="alert alert-warning">Aucune métrique disponible pour cet hôte.</div>
{% endif %}
{% endblock %}
