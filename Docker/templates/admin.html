{% extends "base.html" %}
{% block content %}
<div class="container-fluid">
  <h3 class="mb-4">Dashboard de supervision</h3>

  <!-- =======================
       WIDGETS DE STATISTIQUES
  ======================== -->
 <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-5 g-4 mb-4">
  <div class="col">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body text-center">
        <h6 class="text-muted mb-1">
          <i class="bi bi-hdd-network text-primary"></i> Total h√¥tes
        </h6>
        <h3 class="fw-bold text-primary">{{ total_hosts }}</h3>
      </div>
    </div>
  </div>

  <div class="col">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body text-center">
        <h6 class="text-muted mb-1">
          <i class="bi bi-check-circle-fill text-success"></i> UP
        </h6>
        <h3 class="fw-bold text-success">{{ hosts_up }}</h3>
      </div>
    </div>
  </div>

  <div class="col">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body text-center">
        <h6 class="text-muted mb-1">
          <i class="bi bi-x-octagon-fill text-danger"></i> DOWN
        </h6>
        <h3 class="fw-bold text-danger">{{ hosts_down }}</h3>
      </div>
    </div>
  </div>

  <div class="col">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body text-center">
        <h6 class="text-muted mb-1">
          <i class="bi bi-exclamation-triangle-fill text-warning"></i> WARNING
        </h6>
        <h3 class="fw-bold text-warning">{{ hosts_warning or 0 }}</h3>
      </div>
    </div>
  </div>

  <div class="col">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body text-center">
        <h6 class="text-muted mb-1">
          <i class="bi bi-question-circle-fill text-secondary"></i> Inconnus
        </h6>
        <h3 class="fw-bold text-secondary">{{ hosts_unknown }}</h3>
      </div>
    </div>
  </div>
</div>


  <!-- =======================
       TABLEAU DES H√îTES
  ======================== -->
  {% if hosts %}
  <div class="card shadow-sm">
    <div class="d-flex justify-content-between align-items-center px-2 py-1 border-bottom bg-light rounded-top">
      <h5 class="mb-0">
        <i class="bi bi-hdd-network me-1"></i> Liste des h√¥tes supervis√©s
      </h5>
      <a href="{{ url_for('export_hosts_csv') }}" class="btn btn-outline-success btn-sm px-3">
        <i class="bi bi-download me-1"></i> Exporter
      </a>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Hostname</th>
              <th>IP:Port</th>
              <th>Groupe</th>
              <th>Cat√©gories SNMP</th>
              <th>Tags</th>
              <th>√âtat</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for h in hosts %}
            <tr>
              <td>{{ h.hostname }}</td>
              <td>{{ h.ip }}:{{ h.port }}</td>
              <td>{{ h.group.name if h.group else "-" }}</td>
              <td>
                {% if h.snmp_categories %}
                  {% for c in h.snmp_categories %}
                    <span class="badge bg-info text-dark me-1">{{ c }}</span>
                  {% endfor %}
                {% else %}
                  <span class="text-muted">-</span>
                {% endif %}
              </td>
                <td>
                  {% if h.tags %}
                    {% for t in h.tags %}
                      <span class="badge bg-secondary me-1">{{ t.name }}</span>
                    {% endfor %}
                  {% else %}
                    <span class="text-muted">-</span>
                  {% endif %}
                <td class="align-middle">
                  {% if h.status == 'up' %}
                    <span class="badge bg-success me-2">
                      <i class="bi bi-check-circle"></i> UP
                    </span>
                  {% elif h.status == 'warning' %}
                    <span class="badge bg-warning text-dark me-2">
                      <i class="bi bi-exclamation-triangle"></i> WARNING
                    </span>
                  {% elif h.status == 'down' %}
                    <span class="badge bg-danger me-2">
                      <i class="bi bi-x-octagon"></i> DOWN
                    </span>
                  {% else %}
                    <span class="badge bg-secondary me-2">
                      <i class="bi bi-question-circle"></i> Unknown
                    </span>
                  {% endif %}

                  {% if h.uptime_str and h.uptime_str != '‚Äî' %}
                    <small class="text-muted">{{ h.uptime_str }}</small>
                  {% endif %}
                </td>
              <td class="text-end">
                {% if h.status == 'down' %}
                  <button class="btn btn-sm btn-secondary me-1" disabled>Injoignable</button>
                {% else %}
                  <a class="btn btn-sm btn-outline-primary me-1" href="{{ url_for('host_view', host_id=h.id) }}">
                    <i class="bi bi-eye"></i> View
                  </a>
                {% endif %}
                <a class="btn btn-sm btn-outline-secondary me-1" href="{{ url_for('host_edit', host_id=h.id) }}">
                  <i class="bi bi-pencil"></i> Edit
                </a>
                <form class="d-inline" method="post" action="{{ url_for('host_delete', host_id=h.id) }}"
                      onsubmit="return confirm('Supprimer d√©finitivement {{ h.hostname }} ?');">
                  <button class="btn btn-sm btn-outline-danger" type="submit">
                    <i class="bi bi-trash"></i> Delete
                  </button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% else %}
  <div class="alert alert-info mt-4">
    Aucun h√¥te pour le moment.
  </div>
  {% endif %}
</div>

<!-- üîÑ Rafra√Æchissement automatique -->
<script>
  setInterval(() => location.reload(), 15000);
</script>
{% endblock %}
